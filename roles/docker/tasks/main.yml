---
- name: 'remove older versions on ubuntu'
  when: '(ansible_distribution == "Ubuntu" and ansible_distribution_version == "14.04")'
  apt:
    name:
      - 'docker'
      - 'docker-engine'
    state: 'absent'

- name: 'install extra prequities for ubuntu'
  when: '(ansible_distribution == "Ubuntu" and ansible_distribution_version == "14.04")'
  apt:
    name:
      - 'linux-image-extra-{{ ansible_kernel }}'
      - 'linux-image-extra-virtual'
    state: 'present'

- name: 'install docker dependancies'
  apt:
    name:
      - 'apt-transport-https'
      - 'ca-certificates'
      - 'curl'
      - 'software-properties-common'
      - 'python-pip'
    state: 'present'

- name: 'add docker gpg key'
  apt_key:
    url: 'http://download.docker.com/linux/ubuntu/gpg'
    state: 'present'

- name: 'add docker repo to sources'
  apt_repository:
    repo: 'deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable'
    state: 'present'

- name: 'update apt repo'
  apt:
    name: 'docker-ce'
    state: 'present'
    update_cache: yes
  register: 'install_docker'
